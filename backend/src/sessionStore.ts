export interface Player {
  id: string;
  nickname: string;
  isHost: boolean;
  joinedAt: Date;
}

export interface Session {
  id: string;
  code: string;
  hostId: string;
  players: Map<string, Player>;
  status: 'WAITING' | 'PLAYING' | 'FINISHED';
  createdAt: Date;
}

// In-memory storage (for MVP only)
export class SessionStore {
  private sessions: Map<string, Session> = new Map();
  private codeLookup: Map<string, string> = new Map(); // code -> sessionId
  private socketToSession: Map<string, string> = new Map(); // socketId -> sessionId
  private socketToPlayer: Map<string, string> = new Map(); // socketId -> playerId

  createSession(sessionId: string, code: string, hostId: string): Session {
    const session: Session = {
      id: sessionId,
      code,
      hostId,
      players: new Map(),
      status: 'WAITING',
      createdAt: new Date(),
    };
    
    this.sessions.set(sessionId, session);
    this.codeLookup.set(code, sessionId);
    
    return session;
  }

  getSession(sessionId: string): Session | undefined {
    return this.sessions.get(sessionId);
  }

  getSessionByCode(code: string): Session | undefined {
    const sessionId = this.codeLookup.get(code);
    return sessionId ? this.sessions.get(sessionId) : undefined;
  }

  addPlayer(sessionId: string, player: Player, socketId: string): void {
    const session = this.sessions.get(sessionId);
    if (!session) return;

    session.players.set(player.id, player);
    this.socketToSession.set(socketId, sessionId);
    this.socketToPlayer.set(socketId, player.id);
  }

  removePlayerBySocket(socketId: string): { sessionId: string, playerId: string } | null {
    const sessionId = this.socketToSession.get(socketId);
    const playerId = this.socketToPlayer.get(socketId);

    if (!sessionId || !playerId) return null;

    const session = this.sessions.get(sessionId);
    if (session) {
      session.players.delete(playerId);
    }

    this.socketToSession.delete(socketId);
    this.socketToPlayer.delete(socketId);

    return { sessionId, playerId };
  }

  updateStatus(sessionId: string, status: 'WAITING' | 'PLAYING' | 'FINISHED'): void {
    const session = this.sessions.get(sessionId);
    if (session) {
      session.status = status;
    }
  }

  getSessionBySocket(socketId: string): Session | undefined {
    const sessionId = this.socketToSession.get(socketId);
    return sessionId ? this.sessions.get(sessionId) : undefined;
  }

  getPlayerIdBySocket(socketId: string): string | undefined {
    return this.socketToPlayer.get(socketId);
  }
}

// Singleton instance
export const sessionStore = new SessionStore();
