import { Server, Socket } from 'socket.io';
import { sessionStore } from '../sessionStore';
import { generateCode } from '../utils/generateCode';
import { randomUUID } from 'crypto';

interface CreateSessionData {
  nickname: string;
}

export function handleCreateSession(io: Server, socket: Socket, data: CreateSessionData) {
  try {
    const { nickname } = data;

    // Validate nickname
    if (!nickname || nickname.trim().length === 0) {
      socket.emit('error', { message: 'Nickname is required' });
      return;
    }

    // Generate unique IDs
    const sessionId = randomUUID();
    const playerId = randomUUID();
    const code = generateCode();

    // Create session
    const session = sessionStore.createSession(sessionId, code, playerId);

    // Create host player
    const hostPlayer = {
      id: playerId,
      nickname: nickname.trim(),
      isHost: true,
      joinedAt: new Date(),
    };

    // Add host to session
    sessionStore.addPlayer(sessionId, hostPlayer, socket.id);

    // Join socket room
    socket.join(`session-${sessionId}`);

    // Respond to host
    socket.emit('session-created', {
      sessionId,
      code,
      player: hostPlayer,
    });

    console.log(`✓️ Session created: ${sessionId} with code: ${code}`);
  } catch (error) {
    console.error('Error creating session:', error);
    socket.emit('error', { message: 'Failed to create session' });
  }
}
